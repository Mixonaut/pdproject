<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="apiClient.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Smart Home System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light">
      <div class="container">
        <a class="navbar-brand" href="#">
          <i class="fas fa-home"></i> SmartHome
        </a>
        <div class="ms-auto">
          <button class="btn btn-outline-secondary" id="btnLogout">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>
    </nav>

    <!-- LOADING MODAL -->
    <div class="modal fade" id="loadingModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- LOGOUT CONFIRMATION MODAL -->
    <div class="modal fade" id="logoutConfirmModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Confirm Logout</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p>Are you sure you would like to log out?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="confirmLogout">Logout</button>
          </div>
        </div>
      </div>
    </div>

    <!-- MAIN CONTROLS -->
    <div class="control-grid">
      <button
        class="btn big-button"
        data-bs-toggle="modal"
        data-bs-target="#roomControlModal"
      >
        <i class="fas fa-door-open"></i>
        Room Control
      </button>
      <button
        class="btn big-button"
        data-bs-toggle="modal"
        data-bs-target="#tempModal"
      >
        <i class="fas fa-thermometer-full"></i>
        Temperature
      </button>
      <button 
      class="btn big-button"
      data-bs-toggle="modal"
      data-bs-target="#energyModal"
      >
        <i class="fas fa-bolt"></i>
        Energy Usage
      </button>
      <button 
      class="btn big-button"
      data-bs-toggle="modal"
      data-bs-target="#settingsModal"
      >
        <i class="fas fa-cog"></i>
        Settings
      </button>
    </div>

    <!-- FALL ALERT BUTTON -->
    <div class="fall-alert-container">
      <button class="btn fall-alert-button" id="fallAlertButton">
        <i class="fas fa-exclamation-triangle"></i> Fall Alert
      </button>
      <div
        class="alert alert-success fade mt-3"
        id="fallAlertMessage"
        role="alert"
        style="display: none"
      >
        <i class="fas fa-check-circle me-2"></i> A staff member has been notified
      </div>
    </div>

    <!-- ROOM CONTROL MODAL -->
    <div class="modal fade" id="roomControlModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title fs-4">
              <i class="fas fa-sliders-h me-2"></i>Room Controls
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <!-- Loading Spinner -->
            <div id="deviceLoadingSpinner" class="text-center my-3" style="display: none;">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading devices...</span>
              </div>
            </div>

            <!-- Error Alert -->
            <div id="deviceLoadError" class="alert alert-danger" style="display: none;">
              Error loading devices. Please try again later.
            </div>

            <!-- MAIN MENU -->
            <div class="main-menu text-center">
              <button class="btn modal-menu-button" data-target="lights-control">
                <i class="fas fa-lightbulb"></i> Lights
              </button>
              <button class="btn modal-menu-button" data-target="shutters-control">
                <i class="fas fa-blinds"></i> Shutters
              </button>
              <button class="btn modal-menu-button" data-target="climate-control">
                <i class="fas fa-fan"></i> Climate
              </button>
              <button class="btn modal-menu-button" data-target="other-control">
                <i class="fas fa-ellipsis-h"></i> Other Devices
              </button>
            </div>

            <!-- SUBMENUS -->
            <!-- Lights Control -->
            <div id="lights-control" class="sub-menu" style="display: none;">
              <div class="toggle-container">
                <!-- Dynamic light devices will be loaded here -->
              </div>
              <button class="btn btn-back btn-lg w-100 mt-3">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>
            </div>

            <!-- Shutters Control -->
            <div id="shutters-control" class="sub-menu" style="display: none;">
              <div class="toggle-container">
                <!-- Dynamic shutter devices will be loaded here -->
              </div>
              <button class="btn btn-back btn-lg w-100 mt-3">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>
            </div>

            <!-- Climate Control -->
            <div id="climate-control" class="sub-menu" style="display: none;">
              <div class="toggle-container">
                <!-- Dynamic climate devices will be loaded here -->
              </div>
              <button class="btn btn-back btn-lg w-100 mt-3">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>
            </div>

            <!-- Other Devices Control -->
            <div id="other-control" class="sub-menu" style="display: none;">
              <div class="toggle-container">
                <!-- Dynamic other devices will be loaded here -->
              </div>
              <button class="btn btn-back btn-lg w-100 mt-3">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TEMP CONTROL MODAL -->
    <div class="modal fade" id="tempModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title fs-4">
              <i class="fas fa-thermometer-full me-2"></i>Room Temperature
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="temp-control-wrapper">
              <div class="temp-control-left">
                <!-- Temperature Display -->
                <div class="current-temp-container">
                  <div class="temperature-display">20Â°C</div>
                  <div id="tempFeedback" class="feedback-message"></div>
                </div>

                <!-- Thermometer and Controls -->
                <div class="temp-control-center">
                  <!-- Thermometer -->
                  <div class="thermometer">
                    <div class="touter">
                      <div class="tinner"></div>
                    </div>
                  </div>

                  <!-- Temperature buttons -->
                  <div class="temp-buttons">
                    <button class="btn temp-btn plus-btn" aria-label="Make Warmer">
                      <i class="fas fa-plus"></i>
                      Warmer
                    </button>
                    <button class="btn temp-btn minus-btn" aria-label="Make Cooler">
                      <i class="fas fa-minus"></i>
                      Cooler
                    </button>
                  </div>
                </div>
              </div>

              <div class="temp-list-right">
                <h3>Your Daily Schedule</h3>
                <div class="schedule-help">
                  <i class="fas fa-info-circle"></i>
                  Your room will follow this schedule automatically
                </div>
                <div class="schedule-adjust">
                  <p>Adjust my Schedule</p>
                  <div class="schedule-buttons">
                    <button class="btn adjust-btn warmer-btn">
                      <i class="fas fa-arrow-up"></i> Make It Warmer
                    </button>
                    <button class="btn adjust-btn cooler-btn">
                      <i class="fas fa-arrow-down"></i> Make It Cooler
                    </button>
                  </div>
                </div>
                <div class="schedule-list">
                  <!-- dynamically rendered with js -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--ENERGY MODAL-->
    <div class="modal fade" id="energyModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title fs-4">
              <i class="fas fa-sliders-h me-2"></i>Energy Usage
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="temp-control-wrapper">
              <div class="temp-control-left">
             
              </div>

              <div class="temp-list-right">
                <h3>This months's rankings:</h3>
                <table class="table">
                <thead class="thead">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">First</th>
                    <th scope="col " class="text-center">Energy used (kWh)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">1</th>
                    <td>Mark</td>
                    <td class="text-center align-middle">150</td>
                  </tr>
                  <tr>
                    <th scope="row">2</th>
                    <td>Jacob</td>
                    <td class="text-center align-middle">167</td>
                  </tr>
                  <tr>
                    <th scope="row">3</th>
                    <td>Larry</td>
                    <td class="text-center align-middle">170</td>
                  </tr>

                  <tr>
                    <th scope="row">4</th>
                    <td>Eve</td>
                    <td class="text-center align-middle">171</td>
                  </tr>

                  <tr>
                    <th scope="row">5</th>
                    <td>Cecil</td>
                    <td class="text-center align-middle">175</td>
                  </tr>

                  <tr>
                    <th scope="row">6</th>
                    <td>Debbie</td>
                    <td class="text-center align-middle">188</td>
                  </tr>

                  <tr>
                    <th scope="row">7</th>
                    <td>Nolan</td>
                    <td class="text-center align-middle">189</td>
                  </tr>
                </tbody>
              </table>
                
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>  

     <!--SETTINGS MODAL-->
     <div class="modal fade" id="settingsModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title fs-4">
              <i class="fas fa-sliders-h me-2"></i>Settings
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="itSupContainer">
              <button type="button" class="btn modal-menu-button" id="itHelpButton">Contact IT Support <i class="fa-solid fa-laptop"></i></button>
             <div
               class="alert alert-success fade mt-3"
               id="itHelpmsg"
               role="alert"
               style="display: none"
               >
              <i class="fas fa-check-circle me-2"></i> IT professional is on their way
             </div>
            </div>

            
          </div>
            <button type="button" class="btn modal-menu-button">Account Settings <i class="fa-solid fa-user"></i></button>
            <button type="button" class="btn modal-menu-button">Accesibility <i class="fa-solid fa-eye"></i></button>
          </div>
        </div>
      </div>
    </div>


    
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="menu.js"></script>
    <script>
      // Add logout functionality
      document.getElementById('btnLogout').addEventListener('click', function() {
        // Show confirmation modal
        const logoutConfirmModal = new bootstrap.Modal(document.getElementById('logoutConfirmModal'));
        logoutConfirmModal.show();
      });

      // Handle confirmed logout
      document.getElementById('confirmLogout').addEventListener('click', async function() {
        try {
          // Hide confirmation modal
          const logoutConfirmModal = bootstrap.Modal.getInstance(document.getElementById('logoutConfirmModal'));
          logoutConfirmModal.hide();

          // Show loading modal
          const loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'));
          loadingModal.show();

          // Clear all local storage items
          localStorage.clear();

          // Clear any session storage items
          sessionStorage.clear();

          // Clear any cookies
          document.cookie.split(";").forEach(function(c) {
            document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
          });

          // Redirect to login page
          window.location.href = "/loginpage.html";
        } catch (error) {
          console.error("Error during logout:", error);
          alert("Error logging out. Please try again.");
          const loadingModal = bootstrap.Modal.getInstance(document.getElementById('loadingModal'));
          if (loadingModal) {
            loadingModal.hide();
          }
        }
      });
    </script>
  </body>
</html>
